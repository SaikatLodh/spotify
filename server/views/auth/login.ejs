<!DOCTYPE html>
<html lang="en">
  <%- include('../layout/head.ejs') %>

  <body>
    <div class="login-page">
      <div class="login-container">
        <div id="response"></div>
        <h1>Admin Login</h1>
        <form id="loginForm" method="POSt">
          <div class="mb-3">
            <label for="email" class="form-label">Email address</label>
            <input
              type="email"
              class="form-control"
              id="email"
              name="email"
              value="<%= rememberedEmail %>"
              placeholder="Enter your email"
              required
            />
          </div>
          <div class="mb-4">
            <label for="password" class="form-label">Password</label>
            <input
              type="password"
              class="form-control"
              id="password"
              name="password"
              value="<%= rememberedPassword %>"
              placeholder="Enter your password"
              required
            />
          </div>
          <div class="form-check">
            <input type="checkbox" class="form-check-input" id="remember"
            name="remember" value="<%= remember ? "true" : "false" %>" <% if
            (remember) { %> checked <% } %> />
            <label class="form-check-label text-muted" for="remember">
              Remember me
            </label>
          </div>
          <button type="submit" class="btn btn-primary">Log In</button>
        </form>
        <div style="margin-top: 10px">
          <a href="/sendemail" style="color: #1aa344"> Forgot Password </a>
        </div>
      </div>
    </div>
  </body>

  <script>
    $(document).ready(function () {
      $("#loginForm").submit(function (e) {
        event.preventDefault();
        $("#response").html("");
        $("#loginForm button").prop("disabled", true).text("Loading...");
        $.ajax({
          type: "POST",
          url: "/admin/login",
          data: $("#loginForm").serialize(),
          dataType: "json",
          success: function (response) {
            $("#loginForm button").prop("disabled", false).text("Log In");
            $("#response").html(
              `<p style="color:green;">${response?.message}</p>`
            );
            setTimeout(() => {
              window.location.href = "/";
            }, 500);
          },
          error: function (error) {
            $("#loginForm button").prop("disabled", false).text("Log In");
            $("#response").html(
              `<p style="color:red;">${error?.responseJSON?.message}</p>`
            );
          },
        });
      });
    });
  </script>
</html>
